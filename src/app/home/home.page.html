<ion-menu contentId="main-content">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-title>Men√∫</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list>
      <ion-item (click)="onMenuClick('home')">Inicio (Historial)</ion-item>
      <ion-item (click)="onMenuClick('registro-cita')">Registrar citas</ion-item>
      <ion-item (click)="onMenuClick('busqueda-paciente')">B√∫squeda pacientes</ion-item>
      
      <ion-item lines="none" class="ion-margin-top"></ion-item> 
      <ion-item 
        (click)="onMenuClick('logout')" 
        button 
        detail="false" 
        color="danger" 
        class="ion-margin-horizontal"
        style="--padding-start: 10px; --padding-end: 10px; border-radius: 8px;"
      >
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Cerrar Sesi√≥n
      </ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<div class="ion-page" id="main-content">
  <ion-header [translucent]="true">
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button></ion-menu-button>
      </ion-buttons>
      <ion-title>Bienvenido {{ usuario }}</ion-title>
      
      <ion-buttons slot="end">
        <ion-button (click)="recargarDatos()">
          <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content [fullscreen]="true">
    <ion-header collapse="condense">
      <ion-toolbar>
        <ion-title size="large">Panel Principal</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-searchbar (ionInput)="buscar($event)" placeholder="Buscar por contenido de la acci√≥n..." class="ion-no-padding"></ion-searchbar>
    
    <ion-grid class="ion-margin-vertical">
      <ion-row class="ion-align-items-center ion-padding-horizontal">
        
        <ion-col size="5">
          <ion-card color="tertiary" class="time-card">
            <ion-card-content class="ion-text-center">
              <p class="time-label">Hora Local (API)</p>
              <h3 class="time-value">{{ horaActual || 'Cargando...' }}</h3>
            </ion-card-content>
          </ion-card>
        </ion-col>
        
        <ion-col size="7">
          <ion-button expand="block" color="secondary" (click)="takePicture()" class="camera-button">
            <ion-icon name="camera-outline" slot="start"></ion-icon>
            Capturar Foto
          </ion-button>
        </ion-col>
        
      </ion-row>
    </ion-grid>
    
    <ion-card *ngIf="fotoUrl" class="ion-margin-horizontal">
      <ion-card-header>
        <ion-card-title>√öltima Foto Capturada</ion-card-title>
      </ion-card-header>
      <ion-img [src]="fotoUrl"></ion-img> 
    </ion-card>

    <h2 class="ion-padding-start ion-padding-top">üóìÔ∏è Pr√≥ximas Citas</h2>
    <ion-grid class="ion-padding-bottom">
      
      <ion-row class="header-row ion-text-center ion-align-items-center">
        <ion-col size="4">Paciente</ion-col>
        <ion-col size="4">Especialidad / Cl√≠nica</ion-col>
        <ion-col size="4">Fecha y Hora</ion-col>
      </ion-row>

      <ion-row *ngFor="let cita of citas" class="data-row ion-align-items-center ion-padding-horizontal">
        <ion-col size="4" class="data-col ion-text-start">
            {{ cita.nombre }} {{ cita.apellido }}
        </ion-col>
        <ion-col size="4" class="data-col ion-text-start">
            <strong>{{ cita.especialidad }}</strong><br><small>{{ cita.clinica }}</small>
        </ion-col>
        <ion-col size="4" class="data-col ion-text-end">
            {{ cita.fechaCita | date:'dd/MM HH:mm' }}
        </ion-col>
      </ion-row>
      
      <ion-row *ngIf="citas.length === 0" class="ion-padding">
        <ion-col class="ion-text-center ion-text-medium">
          No hay citas registradas en la base de datos.
        </ion-col>
      </ion-row>
    </ion-grid>

    <hr class="ion-margin-vertical"> 

    <h2 class="ion-padding-start">üìú Historial de Acciones (Logs)</h2>
    <ion-grid>
      <ion-row class="header-row ion-text-center ion-align-items-center">
        <ion-col size="auto">ID</ion-col>
        <ion-col>Registro de Acci√≥n</ion-col>
        <ion-col size="auto">Fecha y Hora</ion-col>
      </ion-row>

      <ion-row *ngFor="let accion of accionesFiltradas" class="data-row ion-align-items-center ion-padding-horizontal">
        <ion-col size="auto" class="ion-text-center data-col">#{{ accion.id }}</ion-col>
        <ion-col class="ion-text-wrap data-col ion-text-start">{{ accion.accion }}</ion-col>
        <ion-col size="auto" class="ion-text-end data-col">{{ accion.fecha | date:'dd/MM/yyyy HH:mm' }}</ion-col>
      </ion-row>
      
      <ion-row *ngIf="accionesFiltradas.length === 0" class="ion-padding">
        <ion-col class="ion-text-center ion-text-medium">
          No hay registros de acciones que coincidan con la b√∫squeda.
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-content>
</div>