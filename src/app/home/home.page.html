<ion-menu contentId="main-content">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-title>Menú</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content>
    <ion-list>
      <ion-item (click)="onMenuClick('home')">Inicio (Historial)</ion-item>
      <ion-item (click)="onMenuClick('registro-cita')">Registrar citas</ion-item>
      <ion-item (click)="onMenuClick('busqueda-paciente')">Búsqueda pacientes</ion-item>
    </ion-list>
  </ion-content>
</ion-menu>

<div class="ion-page" id="main-content">
  <ion-header [translucent]="true">
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button></ion-menu-button>
      </ion-buttons>
      <ion-title>Bienvenido {{ usuario }}</ion-title>
      
      <ion-buttons slot="end">
        <ion-button (click)="recargarDatos()">
          <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content [fullscreen]="true">
    <ion-header collapse="condense">
      <ion-toolbar>
        <ion-title size="large">Historial de Acciones (Logs)</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-searchbar (ionInput)="buscar($event)" placeholder="Buscar por contenido de la acción..."></ion-searchbar>
    
    <ion-card color="tertiary" class="ion-margin-horizontal ion-margin-top">
      <ion-card-content class="ion-text-center">
        <h3 class="ion-no-margin" style="font-weight: bold; color: white;">Hora Local Actual (API)</h3>
        <p style="font-size: 1.8em; font-weight: 700; color: white;">{{ horaActual || 'Cargando...' }}</p>
      </ion-card-content>
    </ion-card>
    
    <ion-button expand="full" color="secondary" (click)="takePicture()" class="ion-margin">
      <ion-icon name="camera-outline" slot="start"></ion-icon>
      Capturar Foto (API Nativa)
    </ion-button>
    
    <ion-card *ngIf="fotoUrl" class="ion-margin">
      <ion-card-header>
        <ion-card-title>Última Foto Capturada</ion-card-title>
      </ion-card-header>
      <ion-img [src]="fotoUrl"></ion-img> 
    </ion-card>

    <ion-grid class="ion-padding">
    <ion-row class="ion-text-center ion-align-items-center" style="background-color: #f4f4f4; border-bottom: 1px solid #ddd; font-weight: 600;">
        <ion-col size="auto">ID</ion-col>
        <ion-col>Registro de Acción</ion-col>
        <ion-col size="auto">Fecha y Hora</ion-col>
      </ion-row>

      <ion-row *ngFor="let accion of accionesFiltradas" class="ion-align-items-center" style="border-bottom: 1px dashed #eee;">
        <ion-col size="auto" class="ion-text-center">#{{ accion.id }}</ion-col>
        <ion-col class="ion-text-wrap">{{ accion.accion }}</ion-col>
        <ion-col size="auto" class="ion-text-end">{{ accion.fecha | date:'dd/MM/yyyy HH:mm' }}</ion-col>
      </ion-row>
      
      <ion-row *ngIf="accionesFiltradas.length === 0" class="ion-padding">
        <ion-col class="ion-text-center ion-text-medium">
          No hay registros de acciones que coincidan con la búsqueda.
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-content>
</div>